# QuecPython 看门狗组件 API 参考手册

QuecPython 看门狗组件在设计上为每一个线程提供单独的软件看门狗对象，用户可以在线程中调用 `WDG.create` 方法创建一个软件看门狗对象 `wdg`，并调用 `wdg.feed` 方法喂狗。

该看门狗组件本质上是基于投票机制来实现的。创建了软件看门狗的线程需周期性调用 `wdg.feed` 方法喂狗，该喂狗动作即为投票。当所有创建了软件看门狗对象的线程均喂狗了，硬件上的看门狗会被触发喂狗。

## 初始化看门狗组件

### `WDG.init`

```python
WDG.init(feed_cycle, feed_impl=None, *args)
```

**参数**

- `feed_cycle` - 硬件看门狗的喂狗周期。
- `feed_impl` - 硬件看门狗的喂狗方法。
    - 看门狗组件根据应用线程投票喂狗的情况，以 `feed_cycle` 为周期，判断是否需要喂硬件看门狗。
    - 原型为 `feed_impl(args)`。传递给 `WDG.init` 方法的 `args` 参数会被传递给 `feed_impl` 方法，用于用户传递自定义参数。
- `args` - 传递给 `feed_impl` 方法的参数。

> 在创建任何一个软件看门狗对象之前调用该方法。一般在应用程序初始化时调用。

## 创建软件看门狗对象

### `WDG.create`

```python
wdg = WDG.create(timeout, queue=None)
```

**参数**

- `timeout` - 软件看门狗的喂狗周期，单位：秒。
- `queue` - 消息队列。
    - 当一个需要喂狗的应用线程存在永久等待消息队列中的消息的场景时，为了避免消息队列长时间没有消息到来，导致线程无法继续运行，进而不能喂狗，在创建软件看门狗时，可以将该消息队列传递给看门狗组件。看门狗组件会以 `feed_cycle` 为周期向该队列发送空消息，以触发应用线程继续运行，得到喂狗的机会。

**返回值**

返回软件看门狗对象 `wdg`。

> - 该方法在需要喂狗的应用线程内调用，一般在 while 循环之前调用。
> - 如果创建软件看门狗对象时添加了消息队列，则应用线程在处理消息时，需要判断消息是否为空。

## 喂软件看门狗

### `wdg.feed`

```python
wdg.feed()
```

> - 该方法由应用线程调用，一般在 while 循环内调用。
> - 一但超过了软件看门狗的喂狗周期还没有喂狗，则硬件看门狗不会喂狗。

## 删除软件看门狗

### `wdg.destroy`

```python
wdg.destroy()
```

> - 该方法在已经创建了软件看门狗对象的应用线程内调用。
> - 一旦删除了软件看门狗对象，该应用线程将不再喂狗，看门狗组件将不再把该应用线程纳入投票机制的考量中。
> - 一般情况下不需要删除软件看门狗对象。
